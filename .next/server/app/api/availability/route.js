"use strict";(()=>{var e={};e.id=325,e.ids=[325,494],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7668:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>H,originalPathname:()=>_,patchFetch:()=>z,requestAsyncStorage:()=>k,routeModule:()=>$,serverHooks:()=>q,staticGenerationAsyncStorage:()=>E,staticGenerationBailout:()=>R});var a={};r.r(a),r.d(a,{POST:()=>P});var n=r(5419),i=r(9108),o=r(9678),s=r(8070),u=r(5256),l=r(1494),d=r(3150),f=r(9997),c=r(3199),g=r(4759),m=r(3137);function p(e,t,r){if("string"==typeof e&&!e.match(c.Z)){var a=d(r);return a.timeZone=t,(0,f.Z)(e,a)}var n=(0,f.Z)(e,r),i=(0,m.Z)(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()).getTime(),o=(0,g.Z)(t,new Date(i));return new Date(i+o)}function v(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(t.length<e)throw TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function y(e){b(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===D(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):(("string"==typeof e||"[object String]"===t)&&"undefined"!=typeof console&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(Error().stack)),new Date(NaN))}function h(e,t){return b(2,arguments),function(e,t){return b(2,arguments),new Date(y(e).getTime()+v(t))}(e,6e4*v(t))}function w(e,t){b(2,arguments);var r=y(e),a=y(t);return r.getTime()>a.getTime()}function T(e,t){b(2,arguments);var r=y(e),a=y(t);return r.getTime()<a.getTime()}let N=process.env.TIMEZONE||"America/Detroit";async function A(e){var t,r,a,n;let{date:i,startTime:o,durationMin:s,existingEvents:u,blocks:l}=e,[d,c]=o.split(":").map(Number),m=i.toISOString().slice(0,10),v=p(`${m}T${o}:00`,N),D=h(v,s);if(t=(0,f.Z)(v,void 0),r=(0,g.Z)(N,t,!0),a=new Date(t.getTime()-r),(n=new Date(0)).setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),n.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),d<9||d>=18)return{isAvailable:!1,reason:"Outside business hours (9 AM - 6 PM)"};for(let e of u){let t=h(e.startAt,-45);if(v<h(e.endAt,45)&&D>t)return{isAvailable:!1,reason:v<e.endAt&&D>e.startAt?"Time slot overlaps with existing booking":"Too close to existing booking (requires 45-minute buffer)"}}for(let e of l)if(w(v,e.startAt)&&T(v,e.endAt)||w(D,e.startAt)&&T(D,e.endAt)||T(v,e.startAt)&&w(D,e.endAt))return{isAvailable:!1,reason:`Unavailable due to ${e.reason.toLowerCase()}`};return{isAvailable:!0}}async function S(e,t,r,a){let n=[];for(let i=9;i<18;i++)for(let o of[0,30]){let s=i+Math.floor((o+t)/60),u=(o+t)%60;if(s>18||18===s&&u>0)continue;let l=`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`,d=e.toISOString().slice(0,10),f=p(`${d}T${l}:00`,N),c={time:l,available:!0,date:f},g=function(e,t,r,a){let n=h(e.date,t);for(let t of a)if(w(e.date,t.startAt)&&T(e.date,t.endAt)||w(n,t.startAt)&&T(n,t.endAt)||T(e.date,t.startAt)&&w(n,t.endAt))return!1;for(let t of r){let r=h(t.startAt,-45),a=h(t.endAt,45);if(e.date<a&&n>r)return!1}return!0}(c,t,r,a);if(c.available=g,!g){let n=await A({date:e,startTime:l,durationMin:t,existingEvents:r,blocks:a});c.reason=n.reason}n.push(c)}return n}var M={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Z=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,C=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,j=/^([+-])(\d{2})(?::?(\d{2}))?$/;function U(e){return e?parseInt(e):1}function I(e){return e&&parseFloat(e.replace(",","."))||0}var O=[31,null,31,30,31,30,31,31,30,31,30,31];function x(e){return e%400==0||e%4==0&&e%100!=0}var Y=r(8727);let F=u.Ry({date:u.Z_().regex(/^\d{4}-\d{2}-\d{2}$/,"Invalid date format (YYYY-MM-DD)"),durationMin:u.Rx().min(30,"Duration must be at least 30 minutes"),addonIds:u.IX(u.Z_()).optional(),mockDatabaseError:u.O7().optional()});async function P(e){try{let t,r,a;let n=await e.json(),i=F.safeParse(n);if(!i.success){let e=i.error.errors[0],t=e?.path?.[0]==="date"&&e?.message==="Required"?"Date is required":e?.message||"Validation error";return s.Z.json({error:t},{status:400})}let{date:o,durationMin:u,addonIds:d=[],mockDatabaseError:f=!1}=i.data;try{if(t=function(e,t){b(1,arguments);var r,a,n,i=v(null!==(r=null==t?void 0:t.additionalDigits)&&void 0!==r?r:2);if(2!==i&&1!==i&&0!==i)throw RangeError("additionalDigits must be 0, 1 or 2");if(!("string"==typeof e||"[object String]"===Object.prototype.toString.call(e)))return new Date(NaN);var o=function(e){var t,r={},a=e.split(M.dateTimeDelimiter);if(a.length>2)return r;if(/:/.test(a[0])?t=a[0]:(r.date=a[0],t=a[1],M.timeZoneDelimiter.test(r.date)&&(r.date=e.split(M.timeZoneDelimiter)[0],t=e.substr(r.date.length,e.length))),t){var n=M.timezone.exec(t);n?(r.time=t.replace(n[1],""),r.timezone=n[1]):r.time=t}return r}(e);if(o.date){var s=function(e,t){var r=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(r);if(!a)return{year:NaN,restDateString:""};var n=a[1]?parseInt(a[1]):null,i=a[2]?parseInt(a[2]):null;return{year:null===i?n:100*i,restDateString:e.slice((a[1]||a[2]).length)}}(o.date,i);a=function(e,t){if(null===t)return new Date(NaN);var r,a,n=e.match(Z);if(!n)return new Date(NaN);var i=!!n[4],o=U(n[1]),s=U(n[2])-1,u=U(n[3]),l=U(n[4]),d=U(n[5])-1;if(i)return l>=1&&l<=53&&d>=0&&d<=6?((r=new Date(0)).setUTCFullYear(t,0,4),a=r.getUTCDay()||7,r.setUTCDate(r.getUTCDate()+((l-1)*7+d+1-a)),r):new Date(NaN);var f=new Date(0);return s>=0&&s<=11&&u>=1&&u<=(O[s]||(x(t)?29:28))&&o>=1&&o<=(x(t)?366:365)?(f.setUTCFullYear(t,s,Math.max(o,u)),f):new Date(NaN)}(s.restDateString,s.year)}if(!a||isNaN(a.getTime()))return new Date(NaN);var u=a.getTime(),l=0;if(o.time&&isNaN(l=function(e){var t=e.match(C);if(!t)return NaN;var r=I(t[1]),a=I(t[2]),n=I(t[3]);return(24===r?0===a&&0===n:n>=0&&n<60&&a>=0&&a<60&&r>=0&&r<25)?36e5*r+6e4*a+1e3*n:NaN}(o.time)))return new Date(NaN);if(o.timezone){if(isNaN(n=function(e){if("Z"===e)return 0;var t=e.match(j);if(!t)return 0;var r="+"===t[1]?-1:1,a=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;return n>=0&&n<=59?r*(36e5*a+6e4*n):NaN}(o.timezone)))return new Date(NaN)}else{var d=new Date(u+l),f=new Date(0);return f.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),f.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),f}return new Date(u+l+n)}(o),isNaN(t.getTime()))return s.Z.json({error:"Invalid date format"},{status:400})}catch(e){return s.Z.json({error:"Invalid date format"},{status:400})}let c=new Date,g=new Date(c.getFullYear(),c.getMonth(),c.getDate());if(T(t,g))return s.Z.json({error:"Cannot book parties in the past"},{status:400});try{r=await l.prisma.event.findMany({where:{date:{gte:new Date(t.getFullYear(),t.getMonth(),t.getDate()),lt:new Date(t.getFullYear(),t.getMonth(),t.getDate()+1)}},select:{startAt:!0,endAt:!0}})}catch(e){if((e?.message||"").includes("Database error"))return s.Z.json({error:"Internal server error"},{status:500});r=[]}try{a=await l.prisma.block.findMany({where:{startAt:{lte:new Date(t.getFullYear(),t.getMonth(),t.getDate()+1)},endAt:{gte:new Date(t.getFullYear(),t.getMonth(),t.getDate())}}})}catch(e){if((e?.message||"").includes("Database error"))return s.Z.json({error:"Internal server error"},{status:500});a=[]}let m=(await S(t,u,r,a)).map(e=>({...e,date:(0,Y.Z)(e.date,"yyyy-MM-dd'T'HH:mm:ssXXX",{timeZone:"America/Detroit"})}));return s.Z.json({slots:m,timezone:"America/Detroit",date:t.toISOString()})}catch(e){if(console.error("Availability API error:",e),e instanceof SyntaxError)return s.Z.json({error:"Invalid JSON"},{status:400});return s.Z.json({error:"Internal server error"},{status:500})}}let $=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/availability/route",pathname:"/api/availability",filename:"route",bundlePath:"app/api/availability/route"},resolvedPagePath:"C:\\Users\\Owner\\Desktop\\splash\\src\\app\\api\\availability\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:k,staticGenerationAsyncStorage:E,serverHooks:q,headerHooks:H,staticGenerationBailout:R}=$,_="/api/availability/route";function z(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:E})}},3157:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(null==e)throw TypeError("assign requires that input parameter not be null or undefined");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},e.exports=t.default},3150:(e,t,r)=>{var a=r(2272).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,n.default)({},e)};var n=a(r(3157));e.exports=t.default},1494:(e,t,r)=>{r.d(t,{prisma:()=>n});var a=r(3524);let n=globalThis.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,256,727],()=>r(7668));module.exports=a})();