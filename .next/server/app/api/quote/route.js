"use strict";(()=>{var e={};e.id=774,e.ids=[774,494],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2841:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>P,originalPathname:()=>w,patchFetch:()=>D,requestAsyncStorage:()=>y,routeModule:()=>v,serverHooks:()=>Z,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>j});var a={};r.r(a),r.d(a,{POST:()=>A});var s=r(5419),n=r(9108),i=r(9678),o=r(8070),u=r(5256),c=r(1494);let d=[{minDistance:0,maxDistance:15,fee:0},{minDistance:16,maxDistance:30,fee:4900},{minDistance:31,maxDistance:50,fee:9900}],l=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];function p(e){let t=[];return e.street.trim()||t.push("Street address is required"),e.city.trim()||t.push("City is required"),e.state.trim()||t.push("State is required"),e.zip.trim()||t.push("Zip code is required"),2!==e.state.length?t.push("State must be 2-letter abbreviation"):l.includes(e.state.toUpperCase())||t.push("Only US addresses supported"),e.zip&&!/^\d{5}(-\d{4})?$/.test(e.zip)&&t.push("Invalid zip code format"),{isValid:0===t.length,errors:t}}async function m(e){try{let t=p(e);if(!t.isValid)return{success:!1,error:`Invalid address: ${t.errors.join(", ")}`};let r=process.env.GOOGLE_MAPS_API_KEY;if(!r)return{success:!1,error:"Google Maps API key not configured"};let a=`${e.street}, ${e.city}, ${e.state} ${e.zip}`,s=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(a)}&key=${r}`,n=await fetch(s),i=await n.json();if("OK"!==i.status||!(i.results.length>0))return{success:!1,error:`Geocoding failed: ${i.status}`};{let e=i.results[0].geometry.location;return{success:!0,location:{lat:e.lat,lng:e.lng}}}}catch(e){return{success:!1,error:`Geocoding error: ${e instanceof Error?e.message:"Unknown error"}`}}}function h(e,t){let r=f(t.lat-e.lat),a=f(t.lng-e.lng),s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(f(e.lat))*Math.cos(f(t.lat))*Math.sin(a/2)*Math.sin(a/2);return Math.round(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*395900)/100}function f(e){return Math.PI/180*e}let g=u.Ry({packageId:u.Z_(),addonIds:u.IX(u.Z_()).default([]),address:u.Ry({street:u.Z_(),city:u.Z_(),state:u.Z_(),zip:u.Z_()}),eventDate:u.Z_(),isGlowNight:u.O7().default(!1)}),M={lat:42.3314,lng:-83.0458};async function A(e){try{let t,r;let a=await e.json(),s=g.safeParse(a);if(!s.success)return o.Z.json({error:"validation failed",details:s.error.errors},{status:400});let{packageId:n,addonIds:i,address:u,eventDate:l,isGlowNight:f}=s.data,A=p(u);if(!A.isValid)return o.Z.json({error:"Invalid address",details:A.errors},{status:400});try{if(!(t=await c.prisma.package.findUnique({where:{id:n,isActive:!0}})))return o.Z.json({error:"Package not found"},{status:404})}catch(e){if(String(e?.message||"").includes("Database connection failed"))return o.Z.json({error:"Internal server error"},{status:500});return o.Z.json({error:"Package not found"},{status:404})}try{if((r=await c.prisma.addon.findMany({where:{id:{in:i},isActive:!0}})).length!==i.length)return o.Z.json({error:"Add-on not found"},{status:404})}catch(e){if(String(e?.message||"").includes("Database connection failed"))return o.Z.json({error:"Internal server error"},{status:500});return o.Z.json({error:"Add-on not found"},{status:404})}let v=await m(u);if(!v.success||!v.location)return o.Z.json({error:"geocoding failed"},{status:400});let y=h(M,v.location),I=function(e,t){let r=h(e,t);return{withinArea:r<=50,distance:r}}(M,v.location);if(!I.withinArea)return o.Z.json({error:"Address is outside service area"},{status:400});let Z={package:{id:t.id,name:t.name,basePrice:t.basePrice,durationMin:t.durationMin,maxGuests:t.maxGuests},addons:r.map(e=>({id:e.id,name:e.name,price:e.price})),distanceMiles:y,isGlowNight:f},P=function(e){let{package:t,addons:r,distanceMiles:a,isGlowNight:s}=e,n=t.basePrice,i=r.reduce((e,t)=>e+t.price,0),o=s&&t.name.includes("Glow Night")?Math.round(.15*n):0,u=n+i+o,c=function(e){if(e>50)throw Error("Distance beyond service area (maximum 50 miles)");let t=d.find(t=>e>=t.minDistance&&e<=t.maxDistance);return t?.fee??0}(a),l=function(e,t=.08){return Math.round(e*t)}(u+c),p=u+c+l,m=function(e,t=.3){return Math.ceil(e*t)}(p),h=p-m,f=[{name:t.name,price:n,type:"package"},...r.map(e=>({name:e.name,price:e.price,type:"addon"})),...o>0?[{name:"Evening Surcharge",price:o,type:"surcharge"}]:[],...c>0?[{name:"Travel Fee",price:c,type:"travel"}]:[],{name:"Tax",price:l,type:"tax"}];return{packagePrice:n,addonsPrice:i,subtotal:u,eveningSurcharge:o,travelFee:c,tax:l,total:p,depositAmount:m,balanceAmount:h,lineItems:f}}(Z);return o.Z.json({...P,distance:y,serviceArea:I.withinArea,address:v.location})}catch(e){if(console.error("Quote API error:",e),e instanceof SyntaxError)return o.Z.json({error:"Invalid JSON"},{status:400});return o.Z.json({error:"Internal server error"},{status:500})}}let v=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/quote/route",pathname:"/api/quote",filename:"route",bundlePath:"app/api/quote/route"},resolvedPagePath:"C:\\Users\\Owner\\Desktop\\splash\\src\\app\\api\\quote\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:I,serverHooks:Z,headerHooks:P,staticGenerationBailout:j}=v,w="/api/quote/route";function D(){return(0,i.patchFetch)({serverHooks:Z,staticGenerationAsyncStorage:I})}},1494:(e,t,r)=>{r.d(t,{prisma:()=>s});var a=r(3524);let s=globalThis.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,256],()=>r(2841));module.exports=a})();